# metadata_keys.rs Review

## TL;DR

- ğŸ”‘ ç›®çš„: Tantivyã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç”¨ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼ã‚’**å¼·ã„å‹ä»˜ã‘**ã§æä¾›ã—ã€æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã®ã‚¿ã‚¤ãƒã«ã‚ˆã‚‹ä¸å…·åˆã‚’é˜²æ­¢
- ğŸŒ å…¬é–‹API: **MetadataKey**ï¼ˆåˆ—æŒ™å‹ï¼‰ã€**MetadataKey::as_str**ï¼ˆã‚­ãƒ¼åå–å¾—ï¼‰ã€**fmt::Display**ï¼ˆæ–‡å­—åˆ—è¡¨ç¾ï¼‰
- âš™ï¸ ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯: enumã®å„**variant**ã‚’é™çš„æ–‡å­—åˆ—ã¸**O(1)**ã§ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã€Displayã§ã‚‚åŒã˜æ–‡å­—åˆ—ã‚’å‡ºåŠ›
- ğŸ›¡ï¸ Rustå®‰å…¨æ€§: **unsafeãªã—**ã€**Copy**å¯èƒ½ã€å…±æœ‰ãƒ»ä¸¦è¡Œåˆ©ç”¨ã‚‚å®‰å…¨ï¼ˆSend/Syncè‡ªå‹•å°å‡ºï¼‰
- ğŸš¨ é‡å¤§ãƒªã‚¹ã‚¯: æ–‡å­—åˆ—ã‚­ãƒ¼ã¯å¤–éƒ¨ï¼ˆTantivyï¼‰ã®**ãƒ‡ãƒ¼ã‚¿å¥‘ç´„**ã®ä¸€éƒ¨ã§ã‚ã‚Šã€å¤‰æ›´ã¯äº’æ›æ€§ç ´å£Šã«ãªã‚Šå¾—ã‚‹
- ğŸ§ª ãƒ†ã‚¹ãƒˆè¦ç‚¹: variantâ‡”æ–‡å­—åˆ—ã®**åŒæ–¹å‘æ€§**ï¼ˆFromStrè¿½åŠ ææ¡ˆï¼‰ã€è¡¨ç¤ºã®ä¸€è‡´ã€å°†æ¥ã®variantè¿½åŠ æ™‚ã®**ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ¤œçŸ¥**ã‚’ç¢ºèª

## Overview & Purpose

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Tantivyã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤ã§ä½¿ç”¨ã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼ã‚’å‹å®‰å…¨ã«æ‰±ã†ãŸã‚ã®å°ã•ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§ã™ã€‚æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ï¼ˆ"file_counter" ãªã©ï¼‰ã‚’ã‚³ãƒ¼ãƒ‰ä¸­ã«æ•£åœ¨ã•ã›ã‚‹ã®ã§ã¯ãªãã€**MetadataKey**åˆ—æŒ™å‹ã®variantã¨ã—ã¦å®šç¾©ã—ã€**as_str**ã‚„**Display**ã§å¿…è¦ãªæ–‡å­—åˆ—è¡¨ç¾ã‚’å–å¾—ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã‚’å®Ÿç¾ã—ã¾ã™:

- æ–‡å­—åˆ—èª¤è¨˜ã«ã‚ˆã‚‹ãƒã‚°ã®å›é¿
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚ˆã‚‹**ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯**ï¼ˆvariantè¿½åŠ æ™‚ã®æœªå¯¾å¿œç®‡æ‰€æ¤œçŸ¥ï¼‰
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ã®**ãƒ‡ãƒ¼ã‚¿å¥‘ç´„ã®æ˜ç¤ºåŒ–**ï¼ˆ"file_counter", "symbol_counter"ï¼‰

ã“ã®ãƒãƒ£ãƒ³ã‚¯ã§ã¯å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚„å®Ÿéš›ã®I/Oã¯ç™»å ´ã›ãšã€ã‚­ãƒ¼ã®å®šç¾©ã¨å¤‰æ›ã®ã¿ã‚’æ‰±ã„ã¾ã™ã€‚

## Structure & Key Components

| ç¨®åˆ¥ | åå‰ | å…¬é–‹ç¯„å›² | è²¬å‹™ | è¤‡é›‘åº¦ |
|------|------|----------|------|--------|
| Enum | MetadataKey | pub | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼ã®å‹å®‰å…¨ãªè¡¨ç¾ï¼ˆFileCounter/SymbolCounterï¼‰ | Low |
| Impl | MetadataKey::as_str | pub | variantâ†’é™çš„æ–‡å­—åˆ—ã¸ã®å¤‰æ› | Low |
| Trait Impl | fmt::Display for MetadataKey | public (ãƒˆãƒ¬ã‚¤ãƒˆå®Ÿè£…) | ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã¸ã®æ–‡å­—åˆ—å‡ºåŠ›ï¼ˆas_strã®å§”è­²ï¼‰ | Low |

### Dependencies & Interactions

- å†…éƒ¨ä¾å­˜
  - fmt::Displayå®Ÿè£…ã¯**MetadataKey::as_str**ã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼ˆé–¢æ•°: fmt, è¡Œç•ªå·: ä¸æ˜ï¼‰ã€‚
- å¤–éƒ¨ä¾å­˜ï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ï¼‰

| ã‚¯ãƒ¬ãƒ¼ãƒˆ/ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | ç”¨é€” | å½±éŸ¿ |
|--------------------|------|------|
| std::fmt | Displayãƒˆãƒ¬ã‚¤ãƒˆå®Ÿè£…ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿å‹ | ãƒ­ã‚°/è¡¨ç¤ºã§æ–‡å­—åˆ—åŒ–ã™ã‚‹éš›ã®APIæä¾› |

- è¢«ä¾å­˜æ¨å®š
  - Tantivyã®ãƒ¡ã‚¿ã‚¹ãƒˆã‚¢ã‚„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤ã®ã‚³ãƒ¼ãƒ‰
  - ã‚­ãƒ¼å€¤ã‚¹ãƒˆã‚¢ï¼ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ãªã©ãŒ**MetadataKey::as_str**ã®æ–‡å­—åˆ—ã‚’åˆ©ç”¨ã™ã‚‹å¯èƒ½æ€§

## API Surface (Public/Exported) and Data Contracts

| APIå | ã‚·ã‚°ãƒãƒãƒ£ | ç›®çš„ | Time | Space |
|-------|-----------|------|------|-------|
| MetadataKeyï¼ˆå‹ï¼‰ | pub enum MetadataKey { FileCounter, SymbolCounter } | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼ã®å¼·ã„å‹ä»˜ã‘ | N/A | N/A |
| as_str | pub fn as_str(&self) -> &'static str | variantã«å¯¾å¿œã™ã‚‹æ–‡å­—åˆ—ã‚­ãƒ¼ã‚’å–å¾— | O(1) | O(1) |
| Display | impl fmt::Display for MetadataKey | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ™‚ã«ã‚­ãƒ¼æ–‡å­—åˆ—ã‚’å‡ºåŠ› | O(1) | O(1) |

### MetadataKeyï¼ˆå‹ï¼‰

1. ç›®çš„ã¨è²¬å‹™
   - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼ã‚’**enum**ã§è¡¨ç¾ã—ã€æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã®ä¹±ç”¨ã¨èª¤è¨˜ã‚’é˜²ãã€‚

2. ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
   - è©²å½“ãªã—ï¼ˆãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼‰ã€‚

3. å¼•æ•°
   - è©²å½“ãªã—ï¼ˆå‹å®šç¾©ï¼‰ã€‚

4. æˆ»ã‚Šå€¤
   - è©²å½“ãªã—ï¼ˆå‹å®šç¾©ï¼‰ã€‚

5. ä½¿ç”¨ä¾‹
```rust
use crate::storage::metadata_keys::MetadataKey;

let key = MetadataKey::FileCounter;
assert_eq!(key as MetadataKey, MetadataKey::FileCounter);
```

6. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
   - åˆ—æŒ™variantã®è¿½åŠ æ™‚ã€é–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆas_str, Displayï¼‰ã«**æœªå¯¾å¿œãŒã‚ã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼**ã§æ¤œçŸ¥ã•ã‚Œã‚‹ã€‚

### MetadataKey::as_str

1. ç›®çš„ã¨è²¬å‹™
   - **MetadataKey**ã®å„variantã«å¯¾å¿œã™ã‚‹**ä¸å¤‰ã®é™çš„æ–‡å­—åˆ—**ï¼ˆ"file_counter" / "symbol_counter"ï¼‰ã‚’è¿”ã™ï¼ˆé–¢æ•°: as_str, è¡Œç•ªå·: ä¸æ˜ï¼‰ã€‚

2. ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆã‚¹ãƒ†ãƒƒãƒ—åˆ†è§£ï¼‰
   - selfã‚’matchã—ã€å„variantã«ç´ã¥ãæ–‡å­—åˆ—ã‚’è¿”å´ã€‚

3. å¼•æ•°

| å¼•æ•°å | å‹ | å¿…é ˆ | èª¬æ˜ |
|-------|----|------|------|
| self | &MetadataKey | å¿…é ˆ | å¤‰æ›å¯¾è±¡ã®ã‚­ãƒ¼ |

4. æˆ»ã‚Šå€¤

| å‹ | èª¬æ˜ |
|----|------|
| &'static str | å¯¾å¿œã™ã‚‹å›ºå®šã®ã‚­ãƒ¼æ–‡å­—åˆ— |

5. ä½¿ç”¨ä¾‹
```rust
use crate::storage::metadata_keys::MetadataKey;

let key = MetadataKey::SymbolCounter;
let s: &'static str = key.as_str();
assert_eq!(s, "symbol_counter");

// å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸APIã«æ¸¡ã™ä¾‹ï¼ˆæ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ï¼‰
fn put_metadata(key: &str, value: u64) { /* ... */ }
put_metadata(MetadataKey::FileCounter.as_str(), 42);
```

6. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
- è¿½åŠ variantæœªå¯¾å¿œæ™‚ã¯**ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼**ï¼ˆå®‰å…¨ï¼‰ã€‚
- è¿”å´æ–‡å­—åˆ—ã¯**'static**ã§ä¸å¤‰ã€‚ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ é–¢é€£ã®å•é¡Œã¯èµ·ããªã„ã€‚

### fmt::Display for MetadataKey

1. ç›®çš„ã¨è²¬å‹™
   - ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ï¼ˆformat!, println!ãªã©ï¼‰ã§**MetadataKey**ãŒ**å¯¾å¿œã™ã‚‹æ–‡å­—åˆ—ã‚­ãƒ¼**ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆé–¢æ•°: fmt, è¡Œç•ªå·: ä¸æ˜ï¼‰ã€‚

2. ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆã‚¹ãƒ†ãƒƒãƒ—åˆ†è§£ï¼‰
   - as_str()ã§æ–‡å­—åˆ—ã‚’å–å¾—
   - Formatterã«write_strã§æ›¸ãè¾¼ã‚€

3. å¼•æ•°

| å¼•æ•°å | å‹ | å¿…é ˆ | èª¬æ˜ |
|-------|----|------|------|
| self | &MetadataKey | å¿…é ˆ | è¡¨ç¤ºå¯¾è±¡ã®ã‚­ãƒ¼ |
| f | &mut fmt::Formatter<'_> | å¿…é ˆ | å‡ºåŠ›å…ˆãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ |

4. æˆ»ã‚Šå€¤

| å‹ | èª¬æ˜ |
|----|------|
| fmt::Result | æ›¸ãè¾¼ã¿æˆå¦ï¼ˆé€šå¸¸ã¯Okã€å‡ºåŠ›å…ˆã‚¨ãƒ©ãƒ¼æ™‚ã¯Errï¼‰ |

5. ä½¿ç”¨ä¾‹
```rust
use crate::storage::metadata_keys::MetadataKey;

let s = format!("{}", MetadataKey::FileCounter);
assert_eq!(s, "file_counter");

// ãƒ­ã‚°å‡ºåŠ›ãªã©
log::info!("updating {}", MetadataKey::SymbolCounter);
```

6. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
- ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿å´ã®I/Oã‚¨ãƒ©ãƒ¼æ™‚ã«**Err(fmt::Error)**ãŒè¿”ã‚‹ã®ã¯æ¨™æº–çš„ãªå‹•ä½œã€‚

## Walkthrough & Data Flow

- å…¸å‹çš„åˆ©ç”¨ãƒ•ãƒ­ãƒ¼
  1. å‘¼ã³å‡ºã—å´ãŒ**MetadataKey**ã®variantï¼ˆä¾‹: FileCounterï¼‰ã‚’é¸æŠ
  2. **as_str**ã§é™çš„æ–‡å­—åˆ—ã«å¤‰æ›
  3. å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸APIã‚„ãƒ­ã‚°ã«ã‚­ãƒ¼æ–‡å­—åˆ—ã‚’æ¸¡ã™
  4. **Display**ã‚’ä½¿ã†å ´åˆã¯format!ã‚„println!ã§ãã®ã¾ã¾æ–‡å­—åˆ—åŒ–

- ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã¯å˜ç´”ã§ã€**æ‰€æœ‰æ¨©ã®ç§»å‹•**ã‚„**ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã®è¤‡é›‘æ€§**ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¿”å´ã¯ã™ã¹ã¦**'static**å‚ç…§ã®å›ºå®šæ–‡å­—åˆ—ã§ã‚ã‚Šã€**ã‚³ãƒ”ãƒ¼å¯èƒ½**ãªenumå€¤ã®ã¿æ‰±ã„ã¾ã™ã€‚

- éåŒæœŸã‚„ä¸¦è¡Œå‡¦ç†ã®å¢ƒç•Œã€awaitã€å…±æœ‰çŠ¶æ…‹ã¯ã“ã®ãƒãƒ£ãƒ³ã‚¯ã«ã¯ç¾ã‚Œã¾ã›ã‚“ã€‚

## Complexity & Performance

- æ™‚é–“è¨ˆç®—é‡
  - MetadataKey::as_str: O(1)ï¼ˆmatchã«ã‚ˆã‚Šå®šæ•°æ™‚é–“ï¼‰
  - fmt::Display: O(1)ï¼ˆas_str + write_strï¼‰

- ç©ºé–“è¨ˆç®—é‡
  - O(1)ï¼ˆå›ºå®šã®å‚ç…§ã§ã‚ã‚Šã€è¿½åŠ ãƒ¡ãƒ¢ãƒªç¢ºä¿ãªã—ï¼‰

- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«é™ç•Œ
  - ãªã—ã€‚æ¥µã‚ã¦è»½é‡ã§ã€ãƒ›ãƒƒãƒˆãƒ‘ã‚¹ã§ã‚‚ç„¡è¦–å¯èƒ½ãªã‚³ã‚¹ãƒˆã§ã™ã€‚

- å®Ÿé‹ç”¨è² è·è¦å› 
  - I/O/ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/DBã¯é–¢ä¸ã—ãªã„ï¼ˆã“ã®ãƒãƒ£ãƒ³ã‚¯ã§ã¯ä¸æ˜ï¼‰ã€‚

## Edge Cases, Bugs, and Security

- ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§
  - **unsafeãªã—**ã€å›ºå®šæ–‡å­—åˆ—ã®å‚ç…§ã®ã¿è¿”å´ã—ã€**use-after-free**ã‚„**ãƒãƒƒãƒ•ã‚¡ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼**ã®æ‡¸å¿µãªã—ã€‚
  - **æ•´æ•°æ¼”ç®—**ãªã—ã®ãŸã‚ã€**æ•´æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼**ã¯ä¸åœ¨ã€‚

- ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
  - è¿”å´æ–‡å­—åˆ—ã¯å›ºå®šã®å†…éƒ¨å®šç¾©ã§ã‚ã‚Šã€å¤–éƒ¨å…¥åŠ›ã«ä¾å­˜ã—ãªã„ãŸã‚**SQL/Command/Path**ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®å¿ƒé…ã¯ãªã„ã€‚

- èªè¨¼ãƒ»èªå¯
  - ã“ã®ãƒãƒ£ãƒ³ã‚¯ã«ã¯ç¾ã‚Œãªã„ã€‚

- ç§˜å¯†æƒ…å ±
  - ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç§˜å¯†æƒ…å ±ã¯ãªã—ã€‚ãƒ­ã‚°å‡ºåŠ›ã‚‚å›ºå®šæ–‡å­—åˆ—ã®ã¿ã€‚

- ä¸¦è¡Œæ€§
  - **MetadataKey**ã¯**Copy/Clone**ã‹ã¤å†…éƒ¨çŠ¶æ…‹ãªã—ã®ãŸã‚ã€**Send/Sync**ãŒè‡ªå‹•å°å‡ºã•ã‚Œã€**ãƒ‡ãƒ¼ã‚¿ç«¶åˆ**ã¯ç™ºç”Ÿã—ãªã„ã€‚

### ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹è©³ç´°è¡¨

| ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ | å…¥åŠ›ä¾‹ | æœŸå¾…å‹•ä½œ | å®Ÿè£… | çŠ¶æ…‹ |
|-------------|--------|----------|------|------|
| è¿½åŠ variantã«å¯¾ã™ã‚‹æœªå¯¾å¿œ | enumã«æ–°variantè¿½åŠ  | as_str/Displayã«å¯¾å¿œãŒãªã‘ã‚Œã°ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã§æ¤œçŸ¥ | matchã§ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ | å¯¾å¿œæ¸ˆï¼ˆå®‰å…¨ï¼‰ |
| ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ã®I/Oã‚¨ãƒ©ãƒ¼ | `fmt::Display`ä¸­ã®`write_str`ã§å¤±æ•— | `fmt::Result::Err`ã‚’è¿”ã™ | `write_str(self.as_str())` | å¯¾å¿œæ¸ˆ |
| æ–‡å­—åˆ—å¥‘ç´„ã®å¤‰æ›´ | "file_counter"ã‚’å¤‰æ›´ | æ—¢å­˜ãƒ‡ãƒ¼ã‚¿/å¤–éƒ¨APIã¨ã®äº’æ›æ€§ç ´å£Šã®å¯èƒ½æ€§ | å›ºå®šæ–‡å­—åˆ—ã‚’è¿”å´ | æ³¨æ„å–šèµ·å¿…è¦ |
| å¤§æ–‡å­—/å°æ–‡å­—ã®é•ã„ | "File_Counter"ç­‰ | ä»•æ§˜å¤–ã€‚å¤–éƒ¨å¥‘ç´„ã«ä¸€è‡´ã—ãªã„å ´åˆã¯ä¸å…·åˆ | å›ºå®šã§å°æ–‡å­—è¿”å´ | ä»•æ§˜æ˜ç¢ºåŒ–æ¨å¥¨ |

æ ¹æ‹ ï¼ˆé–¢æ•°å:è¡Œç•ªå·ï¼‰
- as_str: è¡Œç•ªå·ã¯ã“ã®ãƒãƒ£ãƒ³ã‚¯ã§ã¯ä¸æ˜ã€‚matchã§å„variantã«å›ºå®šæ–‡å­—åˆ—ã‚’å‰²ã‚Šå½“ã¦ã€‚
- fmtï¼ˆDisplayå®Ÿè£…ï¼‰: è¡Œç•ªå·ã¯ä¸æ˜ã€‚`write_str(self.as_str())`ã§å§”è­²ã€‚

## Design & Architecture Suggestions

- æ–‡å­—åˆ—â†’variantã®é€†å¤‰æ›ã‚’æä¾›
  - `impl std::str::FromStr for MetadataKey` ã¾ãŸã¯ `impl TryFrom<&str> for MetadataKey` ã‚’è¿½åŠ ã—ã€å¤–éƒ¨å…¥åŠ›ï¼ˆæ—¢å­˜ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ã‹ã‚‰å®‰å…¨ã«å¾©å…ƒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
- ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º/ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
  - `serde::{Serialize, Deserialize}`å°å…¥ã«ã‚ˆã‚Šè¨­å®šã‚„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ã®æ‰±ã„ã‚’ç°¡ç´ åŒ–ï¼ˆä¾å­˜è¿½åŠ ã®å½±éŸ¿ã¯è¦è©•ä¾¡ï¼‰ã€‚
- conståŒ–
  - `const fn as_str(&self) -> &'static str`ã«ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã‚‚åˆ©ç”¨å¯èƒ½ã«ï¼ˆRustã®åˆ¶ç´„ã«é©åˆã™ã‚‹ç¯„å›²ã§ï¼‰ã€‚
- ãƒ‡ãƒ¼ã‚¿å¥‘ç´„ã®æ˜æ–‡åŒ–
  - "file_counter" / "symbol_counter" ãŒå¤–éƒ¨ä»•æ§˜ï¼ˆTantivyã®æœŸå¾…ï¼‰ã§ã‚ã‚‹æ—¨ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§æ˜è¨˜ã€‚å¤‰æ›´æ™‚ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æŒ‡é‡ã‚’ç”¨æ„ã€‚
- APIã®ä¸€è²«æ€§
  - `impl From<MetadataKey> for &'static str` ã‚’è¿½åŠ ã™ã‚‹ã¨ã€`Into<&str>`ã§ã®è‡ªç„¶ãªåˆ©ç”¨ãŒå¯èƒ½ã€‚
- å°†æ¥æ‹¡å¼µæ™‚ã®æŒ‡é‡
  - variantè¿½åŠ æ™‚ã®å¯¾å¿œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆas_str/Display/FromStr/ãƒ†ã‚¹ãƒˆï¼‰ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®CONTRIBUTINGã«è¨˜è¼‰ã€‚

## Testing Strategy (Unit/Integration) with Examples

- å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆmappingã®æ­£å½“æ€§ï¼‰
```rust
#[cfg(test)]
mod tests {
    use super::MetadataKey;

    #[test]
    fn as_str_maps_correctly() {
        assert_eq!(MetadataKey::FileCounter.as_str(), "file_counter");
        assert_eq!(MetadataKey::SymbolCounter.as_str(), "symbol_counter");
    }

    #[test]
    fn display_outputs_same_as_as_str() {
        assert_eq!(format!("{}", MetadataKey::FileCounter), MetadataKey::FileCounter.as_str());
        assert_eq!(format!("{}", MetadataKey::SymbolCounter), MetadataKey::SymbolCounter.as_str());
    }
}
```

- é€†å¤‰æ›ãƒ†ã‚¹ãƒˆï¼ˆFromStr/TryFromã‚’è¿½åŠ ã—ãŸå ´åˆï¼‰
```rust
#[cfg(test)]
mod parse_tests {
    use super::MetadataKey;
    use std::str::FromStr;

    #[test]
    fn parse_metadata_key() {
        assert_eq!(MetadataKey::from_str("file_counter").unwrap(), MetadataKey::FileCounter);
        assert_eq!(MetadataKey::from_str("symbol_counter").unwrap(), MetadataKey::SymbolCounter);
        assert!(MetadataKey::from_str("unknown_key").is_err());
    }
}
```

- äº’æ›æ€§ãƒ†ã‚¹ãƒˆï¼ˆIntegrationï¼‰
  - ã“ã®ãƒãƒ£ãƒ³ã‚¯ã«ã¯ç¾ã‚Œãªã„ãŒã€Tantivyãƒ¡ã‚¿ã‚¹ãƒˆã‚¢ã«å¯¾ã—ã¦`as_str`ã®æ–‡å­—åˆ—ãŒæœŸå¾…é€šã‚Šæ‰±ã‚ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ¨å¥¨ã€‚

## Refactoring Plan & Best Practices

- å¤‰æ›´å®¹æ˜“æ€§
  - æ–‡å­—åˆ—ã®**å®šæ•°åŒ–**ã‚„`const fn`åŒ–ã§åˆ©ç”¨ç®‡æ‰€ã®å®‰å…¨æ€§ã‚’å‘ä¸Šã€‚
- åŒæ–¹å‘API
  - `FromStr/TryFrom<&str>`ã‚’ç”¨æ„ã—ã¦ã€å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®å¾©å…ƒã‚’å®‰å…¨ã«ã€‚
- ä¾å­˜ã®æœ€å°åŒ–
  - ç¾çŠ¶ã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ã§ååˆ†ã€‚`strum`ç­‰ã®å°å…¥ã¯æ˜ç¢ºãªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹å ´åˆã®ã¿æ¤œè¨ã€‚
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å……å®Ÿ
  - æ–‡å­—åˆ—ã‚­ãƒ¼ãŒå¤–éƒ¨å¥‘ç´„ã«å±ã™ã‚‹æ—¨ã¨å¤‰æ›´æ‰‹é †ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’README/Docã«æ˜è¨˜ã€‚
- ãƒ†ã‚¹ãƒˆã®ç¶²ç¾…
  - è¿½åŠ variantæ™‚ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¤ã¤ã€**ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ**ã®ç¶™ç¶šçš„æ•´å‚™ã€‚

## Observability (Logging, Metrics, Tracing)

- ãƒ­ã‚°
  - `Display`ã«ã‚ˆã‚Š`format!("{}", MetadataKey::FileCounter)`ã§ç›´æ¥ã‚­ãƒ¼åã‚’ãƒ­ã‚°å‡ºåŠ›å¯èƒ½ã€‚å¯èª­æ€§å‘ä¸Šã€‚
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹/ãƒˆãƒ¬ãƒ¼ã‚¹
  - ã“ã®ãƒãƒ£ãƒ³ã‚¯ã«ã¯ç¾ã‚Œãªã„ã€‚å¿…è¦ãªã‚‰ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã®å›æ•°ã‚„å¤±æ•—ç‡ãªã©ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ç®‡æ‰€ã§ã‚­ãƒ¼åã‚’ã‚¿ã‚°ã¨ã—ã¦ä½¿ç”¨å¯èƒ½ã€‚

## Risks & Unknowns

- å¤–éƒ¨å¥‘ç´„ã®ä¸ç¢ºå®Ÿæ€§
  - Tantivyå´ãŒã‚­ãƒ¼åã‚’å¤‰æ›´ãƒ»æ‹¡å¼µã—ãŸå ´åˆã€äº’æ›æ€§ã«å½±éŸ¿ã€‚ç¾è¡Œã®æ–‡å­—åˆ—ãŒå…¬å¼ä»•æ§˜ã«ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ã¯ã“ã®ãƒãƒ£ãƒ³ã‚¯ã§ã¯ä¸æ˜ã€‚
- ç”¨é€”ã®ç¯„å›²
  - ã©ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸APIãŒã“ã®ã‚­ãƒ¼ã‚’æ¶ˆè²»ã™ã‚‹ã‹ã€ã“ã®ãƒãƒ£ãƒ³ã‚¯ã«ã¯ç¾ã‚Œãªã„ã€‚
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥
  - ã‚­ãƒ¼åå¤‰æ›´ã®å¿…è¦ãŒç”Ÿã˜ãŸå ´åˆã®ç§»è¡Œè¨ˆç”»ï¼ˆæ—§åã¨ã®äº’æ›ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€å†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãªã©ï¼‰ã¯ä¸æ˜ã€‚